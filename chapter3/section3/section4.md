<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
# 一致性

为了满足一致性要求，必须表明所有nonfaulty节点（不管它们的UNLS）在相同的一组交易上达成了共识。因为每个服务器的UNLS可以是不同的，所以一致性无法通过正确性证明来进行保证。例如，如果对UNL的成员资格没有任何限制，并且UNL的大小不大于\\(0.2 * n_{total}\\)，其中\\(n_{total}\\)整个分布式交易系统中节点的数量，那么就有可能有一个分叉。这可以用一个简单的例子来说明，如下图：
![younghz的Markdown库](/asserts/2.bmp "图二")
####图2.防止两个UNL集团之间出现分叉所需的连接性示例。
想象UNL图中的两个小圈子，每一个都大于\\(0.2 * n_{total}\\)。所谓小圈子，我们指的是一组节点，其中每个节点的UNL是完全相同的一组节点。因为这两个小圈子不共享任何成员，所以每个小圈子都有可能实现一个正确的一致性过程。如果两个小圈子的连通性超过\\(0.2 * n_{total}\\)，那么分叉就不再可能了，因为两个小圈子之间存在分歧会阻止整个系统在80%一致性阈值上达成共识。
下面是达成共识所需要的最小连通率的公式：
$$|UNL_i \cap UNL_j| \geq \frac{1}{5}max(|UNL_i|, |UNL_j|) \forall i,j$$
这个上界假设UNL是一个小集团，这些节点组成了一个集合，这个集合的UNLS包含其他集合的节点。这个上限保证没有任何两个小集团能够就欺诈交易达成共识，这是因为两个小集团无法就欺诈交易达到80%的共识门槛。如果还考虑到UNL之间的间接边，则可能会有更紧的边界（达成共识所需要的最小连通率会更加小）。如果网络的结构不是团状的，则由于所有节点的UNL的纠缠程度更大，分叉变得更难实现。
值得注意的是，没有对相交节点的性质作出任何假设。两个UNL的交集可能包括faulty节点，但只要交集的大小大于保证一致性过程所需的下界，并且faulty节点的总数小于满足正确性所需的上界，则正确性和一致性都将可以实现。也就是说，一致性达成与否仅取决于集团之间节点的相交数量，而不是取决于集团之间unfaulty节点的相交数量。